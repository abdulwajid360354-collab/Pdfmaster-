<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merge PDF | Professional Tool</title>
    
    <!-- UI Framework -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Libraries -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { 
                        indigo: { 500: '#6366f1', 600: '#4f46e5' } 
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; }

        /* File Card Styling */
        .file-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.2s;
            cursor: grab;
            position: relative;
        }

        .file-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .file-card:active { cursor: grabbing; }

        /* Sortable Ghost */
        .sortable-ghost {
            opacity: 0.4;
            background: #eef2ff;
            border: 2px dashed #6366f1;
        }

        /* Loader */
        .loader {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 20px; height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navbar -->
    <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200 h-16 sticky top-0 z-50 px-6 flex items-center justify-between shadow-sm">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/30">
                <i class="fa-solid fa-layer-group"></i>
            </div>
            <span class="text-xl font-bold text-slate-800 tracking-tight">PDF<span class="text-indigo-600">Merger</span></span>
        </div>
        
        <div id="count-badge" class="hidden">
            <span class="px-4 py-1.5 bg-indigo-50 text-indigo-700 text-sm font-bold rounded-full border border-indigo-100">
                <span id="file-count">0</span> Files loaded
            </span>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow p-6 w-full max-w-5xl mx-auto">
        
        <!-- Upload Area -->
        <div id="upload-state" class="flex flex-col items-center justify-center mt-12 bg-white rounded-3xl border-2 border-dashed border-slate-300 p-16 text-center transition hover:border-indigo-500 hover:bg-indigo-50/30 cursor-pointer group" onclick="document.getElementById('file-input').click()">
            <input type="file" id="file-input" accept="application/pdf" multiple class="hidden">
            
            <div class="w-24 h-24 bg-indigo-50 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300 shadow-sm">
                <i class="fa-solid fa-copy text-4xl text-indigo-500"></i>
            </div>
            
            <h2 class="text-3xl font-bold text-slate-800 mb-2">Merge PDF Files</h2>
            <p class="text-slate-500 text-lg mb-8 max-w-md mx-auto">Combine multiple PDFs into one document. Drag & Drop to reorder.</p>
            
            <button class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-3.5 rounded-full font-bold shadow-xl shadow-indigo-500/20 hover:shadow-indigo-500/40 hover:-translate-y-1 transition-all duration-300 flex items-center gap-2">
                <i class="fa-solid fa-plus"></i> Select PDF Files
            </button>
        </div>

        <!-- Editor Area -->
        <div id="editor-state" class="hidden pb-32">
            
            <div class="flex flex-wrap items-center justify-between mb-6 gap-4">
                <div>
                    <h3 class="text-xl font-bold text-slate-800">Files to Merge</h3>
                    <p class="text-sm text-slate-500">Drag files to change order</p>
                </div>
                
                <button onclick="document.getElementById('file-input').click()" class="px-5 py-2.5 bg-white border border-slate-200 text-indigo-600 font-bold rounded-xl hover:bg-indigo-50 hover:border-indigo-300 transition shadow-sm text-sm flex items-center gap-2">
                    <i class="fa-solid fa-plus"></i> Add More
                </button>
            </div>

            <!-- List Container -->
            <div id="file-list" class="space-y-3">
                <!-- File Cards injected here -->
            </div>
        </div>

    </main>

    <!-- Floating Action Bar -->
    <div id="action-bar" class="hidden fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-white/90 backdrop-blur-xl border border-white/20 p-2 pr-3 pl-6 rounded-full shadow-2xl items-center gap-6 z-50 ring-1 ring-black/5 animate-fade-in transition-all">
        <div class="flex flex-col">
            <span class="text-xs text-slate-500 font-medium uppercase tracking-wide">Ready to merge</span>
            <span id="total-size" class="text-sm font-bold text-slate-800">0 MB</span>
        </div>
        
        <button onclick="mergeAndDownload()" id="merge-btn" class="bg-slate-900 hover:bg-black text-white px-8 py-3 rounded-full font-bold transition-all flex items-center gap-2 shadow-lg">
            <span class="loader hidden" id="loader"></span>
            <span id="btn-text">Merge PDF</span>
            <i id="btn-icon" class="fa-solid fa-arrow-right"></i>
        </button>
    </div>

    <script>
        // State
        let filesData = []; // Array of { id, fileObj, name, size }

        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const mergeBtn = document.getElementById('merge-btn');
        const btnText = document.getElementById('btn-text');
        const btnIcon = document.getElementById('btn-icon');
        const loader = document.getElementById('loader');

        // --- 1. UPLOAD HANDLING ---
        fileInput.addEventListener('change', (e) => {
            const newFiles = Array.from(e.target.files);
            if (newFiles.length === 0) return;

            // Add new files to state
            newFiles.forEach(file => {
                if (file.type === 'application/pdf') {
                    filesData.push({
                        id: Date.now() + Math.random(), // Unique ID
                        file: file,
                        name: file.name,
                        size: (file.size / 1024 / 1024).toFixed(2)
                    });
                }
            });

            updateUI();
            
            // UI Switch
            document.getElementById('upload-state').classList.add('hidden');
            document.getElementById('editor-state').classList.remove('hidden');
            document.getElementById('action-bar').classList.remove('hidden');
            document.getElementById('action-bar').classList.add('flex');
            document.getElementById('count-badge').classList.remove('hidden');
        });

        // --- 2. RENDER LIST ---
        function updateUI() {
            fileList.innerHTML = '';
            let totalSize = 0;

            filesData.forEach((item, index) => {
                totalSize += parseFloat(item.size);

                const card = document.createElement('div');
                card.className = 'file-card animate-fade-in';
                card.setAttribute('data-id', item.id);
                
                card.innerHTML = `
                    <div class="text-slate-400 cursor-grab active:cursor-grabbing hover:text-indigo-500">
                        <i class="fa-solid fa-grip-vertical text-lg"></i>
                    </div>
                    
                    <div class="w-10 h-10 bg-red-50 text-red-500 rounded-lg flex items-center justify-center text-xl shrink-0">
                        <i class="fa-solid fa-file-pdf"></i>
                    </div>
                    
                    <div class="flex-grow min-w-0">
                        <h4 class="font-bold text-slate-700 truncate text-sm">${item.name}</h4>
                        <p class="text-xs text-slate-400">${item.size} MB</p>
                    </div>

                    <button onclick="removeFile('${item.id}')" class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:bg-red-50 hover:text-red-500 transition">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                `;
                
                fileList.appendChild(card);
            });

            // Update Counts
            document.getElementById('file-count').textContent = filesData.length;
            document.getElementById('total-size').textContent = totalSize.toFixed(2) + " MB";

            // Initialize Sortable
            initSortable();
        }

        // --- 3. SORTABLE JS (Reordering) ---
        function initSortable() {
            new Sortable(fileList, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                handle: '.file-card', // Entire card is draggable
            });
        }

        // --- 4. REMOVE FILE ---
        window.removeFile = (id) => {
            filesData = filesData.filter(f => f.id != id); // Filter out
            updateUI();
            
            // If empty, show upload screen
            if(filesData.length === 0) {
                location.reload();
            }
        };

        // --- 5. MERGE LOGIC ---
        async function mergeAndDownload() {
            if (filesData.length < 2) {
                alert("Please select at least 2 PDF files to merge.");
                return;
            }

            // Loading UI
            mergeBtn.disabled = true;
            btnIcon.classList.add('hidden');
            loader.classList.remove('hidden');
            btnText.textContent = "Merging...";

            try {
                const { PDFDocument } = PDFLib;
                const mergedPdf = await PDFDocument.create();

                // Get Current Order from DOM (SortableJS might have changed it)
                const domCards = document.querySelectorAll('.file-card');
                
                // Iterate through visual order
                for (const card of domCards) {
                    const id = card.getAttribute('data-id');
                    const fileObj = filesData.find(f => f.id == id).file;
                    
                    const fileBytes = await fileObj.arrayBuffer();
                    const pdf = await PDFDocument.load(fileBytes);
                    
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach((page) => mergedPdf.addPage(page));
                }

                // Save
                const pdfBytes = await mergedPdf.save();
                downloadFile(pdfBytes, "Merged_Document.pdf");

                // Success UI
                loader.classList.add('hidden');
                btnIcon.className = "fa-solid fa-check";
                btnIcon.classList.remove('hidden');
                btnText.textContent = "Done!";
                mergeBtn.classList.replace('bg-slate-900', 'bg-green-600');

                setTimeout(() => {
                    btnText.textContent = "Merge PDF";
                    btnIcon.className = "fa-solid fa-arrow-right";
                    mergeBtn.disabled = false;
                    mergeBtn.classList.replace('bg-green-600', 'bg-slate-900');
                }, 3000);

            } catch (err) {
                console.error(err);
                alert("Error merging PDFs. Ensure files are not password protected.");
                loader.classList.add('hidden');
                mergeBtn.disabled = false;
                btnText.textContent = "Try Again";
            }
        }

        function downloadFile(data, filename) {
            const blob = new Blob([data], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
